#!/bin/bash

case "$1" in
  -*) ;; *) command="$1"; shift ;;
esac

if [[ $command ]]; then
  "flower-$command" "$@"
elif [[ -f package.json ]]; then
  echo 'Found package.json; delegating server launch to NPM.'
  flower ps1 npm start
elif [[ -f server.js ]]; then
  echo 'Found server.js; launching server directly...'
  flower ps1 node server.js
else
  echo 'Starting default Flower server...'
  [[ $PORT ]] || [[ -f .port ]] || flower pick-port
  flower ps1 node -e 'require("flower").listen()'
fi
